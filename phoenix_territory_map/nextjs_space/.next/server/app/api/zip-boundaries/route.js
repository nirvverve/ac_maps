"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55315:e=>{e.exports=require("path")},11e3:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>A,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var i={};r.r(i),r.d(i,{POST:()=>m});var o=r(49303),n=r(88716),a=r(60670),s=r(87070);let l=require("fs/promises");var p=r(55315),u=r(35860);let d=null;async function c(){if(!d){let e=(0,p.join)(process.cwd(),"public","az-zip-boundaries.json");d=JSON.parse(await (0,l.readFile)(e,"utf-8"))}return d}async function m(e){let t=(0,u.Tr)("zip-boundaries",e,u.rk.zipBoundaries);if(t)return t;try{let t=(await e.json()).zipCodes||[];if(!t.length)return s.NextResponse.json({error:"No zip codes provided"},{status:400});let i=await c(),o=new Map(t.map(({zip:e,area:t})=>[e.toString(),t])),n=[];for(let e of i.features){var r;let t=e.properties?.ZCTA5CE10||e.properties?.GEOID10||e.properties?.ZCTA;if(!t)continue;let i=o.get(t.toString());if(i){for(let o of(r=e.geometry)?"Polygon"===r.type?[r.coordinates[0]]:"MultiPolygon"===r.type?r.coordinates.map(e=>e[0]):[]:[])if(o.length>0){let e=o.map(e=>({lat:e[1],lng:e[0]})),r=function(e){let t=0,r=0,i=0;for(let o of e)r+=o[0],t+=o[1],i++;return{lat:t/i,lng:r/i}}(o);n.push({zipCode:parseInt(t),area:i,paths:e,center:r})}}}let a=new Set(n.map(e=>e.zipCode)),l=t.filter(({zip:e})=>!a.has(parseInt(String(e))));if(l.length>0){let e="AIzaSyAKMtorawPHrpVNqAZlv5vUpfMSDif57MQ";for(let t=0;t<l.length;t+=10){let r=l.slice(t,t+10);await Promise.all(r.map(async({zip:t,area:r})=>{try{if(!e)return;let i=`https://maps.googleapis.com/maps/api/geocode/json?address=${t}&key=${e}`,o=await fetch(i),a=await o.json();if("OK"===a.status&&a.results?.[0]){let e=a.results[0],i=e.geometry.location,o=e.geometry.bounds;if(o){let e=[{lat:o.northeast.lat,lng:o.northeast.lng},{lat:o.northeast.lat,lng:o.southwest.lng},{lat:o.southwest.lat,lng:o.southwest.lng},{lat:o.southwest.lat,lng:o.northeast.lng}];n.push({zipCode:t,area:r,paths:e,center:i})}}}catch(e){console.error(`Error fetching fallback boundary for zip ${t}:`,e)}})),t+10<l.length&&await new Promise(e=>setTimeout(e,1e3))}}return s.NextResponse.json({boundaries:n})}catch(e){return console.error("Error in zip-boundaries API:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/zip-boundaries/route",pathname:"/api/zip-boundaries",filename:"route",bundlePath:"app/api/zip-boundaries/route"},resolvedPagePath:"/data/projects/ac_maps/phoenix_territory_map/nextjs_space/app/api/zip-boundaries/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:w}=f,y="/api/zip-boundaries/route";function A(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},35860:(e,t,r)=>{r.d(t,{Tr:()=>s,rk:()=>o});var i=r(87070);let o={adminUpload:{limit:5,windowSeconds:60},zipBoundaries:{limit:30,windowSeconds:60},auth:{limit:10,windowSeconds:900}},n=new Map,a=null;function s(e,t,r){let o=function(e,t,r){let i;let o=((i=n.get(e))||(i=new Map,n.set(e,i),!a&&(a=setInterval(()=>{let e=Date.now();for(let[,t]of n)for(let[r,i]of t)i.resetAt<=e&&t.delete(r)},6e4))&&"object"==typeof a&&"unref"in a&&a.unref()),i),s=function(e){let t=e.headers.get("x-forwarded-for");return t?t.split(",")[0].trim():e.headers.get("x-real-ip")||"127.0.0.1"}(t),l=Date.now(),p=o.get(s);return!p||p.resetAt<=l?(o.set(s,{count:1,resetAt:l+1e3*r.windowSeconds}),{allowed:!0,limit:r.limit,remaining:r.limit-1,resetAt:l+1e3*r.windowSeconds}):(p.count++,p.count>r.limit)?{allowed:!1,limit:r.limit,remaining:0,resetAt:p.resetAt}:{allowed:!0,limit:r.limit,remaining:r.limit-p.count,resetAt:p.resetAt}}(e,t,r);if(!o.allowed){let e=Math.ceil((o.resetAt-Date.now())/1e3),t=i.NextResponse.json({error:"Too many requests",retryAfter:e},{status:429});return t.headers.set("Retry-After",e.toString()),t.headers.set("X-RateLimit-Limit",o.limit.toString()),t.headers.set("X-RateLimit-Remaining",Math.max(0,o.remaining).toString()),t.headers.set("X-RateLimit-Reset",Math.ceil(o.resetAt/1e3).toString()),t}return null}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9276,5972],()=>r(11e3));module.exports=i})();